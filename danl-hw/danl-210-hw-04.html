<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Byeong-Hak Choe">
<meta name="dcterms.date" content="2025-04-18">

<title>Homework 4 | Byeong-Hak Choe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../assets/css/font.css">
<meta property="og:title" content="Homework 4 | Byeong-Hak Choe">
<meta property="og:description" content="Python selenium, APIs, &amp; Pandas Basics">
<meta property="og:image" content="/assets/img/posts.png">
<meta property="og:site-name" content="Home">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/geneseo-logo-squared.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../danl-ex/danl-210-exam-1-a.html" rel="" target="">
 <span class="menu-text">Exam</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../danl-rw/danl-210-project.html" rel="" target="">
 <span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/bcdanl/210-code" rel="" target="_blank">
 <span class="menu-text">Class Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog-listing.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text"> </span></li>
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#direction" id="toc-direction" class="nav-link active" data-scroll-target="#direction">Direction</a></li>
  <li><a href="#part-1.-data-collection" id="toc-part-1.-data-collection" class="nav-link" data-scroll-target="#part-1.-data-collection">Part 1. Data Collection</a>
  <ul>
  <li><a href="#question-1" id="toc-question-1" class="nav-link" data-scroll-target="#question-1">Question 1</a></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a></li>
  </ul></li>
  <li><a href="#part-2.-pandas-basics" id="toc-part-2.-pandas-basics" class="nav-link" data-scroll-target="#part-2.-pandas-basics">Part 2. Pandas Basics</a>
  <ul>
  <li><a href="#variable-description" id="toc-variable-description" class="nav-link" data-scroll-target="#variable-description">Variable Description</a></li>
  <li><a href="#question-3" id="toc-question-3" class="nav-link" data-scroll-target="#question-3">Question 3</a></li>
  <li><a href="#question-4" id="toc-question-4" class="nav-link" data-scroll-target="#question-4">Question 4</a></li>
  <li><a href="#question-5" id="toc-question-5" class="nav-link" data-scroll-target="#question-5">Question 5</a></li>
  <li><a href="#question-6" id="toc-question-6" class="nav-link" data-scroll-target="#question-6">Question 6</a></li>
  <li><a href="#question-7" id="toc-question-7" class="nav-link" data-scroll-target="#question-7">Question 7</a></li>
  <li><a href="#question-8" id="toc-question-8" class="nav-link" data-scroll-target="#question-8">Question 8</a></li>
  <li><a href="#question-9" id="toc-question-9" class="nav-link" data-scroll-target="#question-9">Question 9</a></li>
  <li><a href="#question-10" id="toc-question-10" class="nav-link" data-scroll-target="#question-10">Question 10</a></li>
  <li><a href="#question-11" id="toc-question-11" class="nav-link" data-scroll-target="#question-11">Question 11</a></li>
  <li><a href="#question-12" id="toc-question-12" class="nav-link" data-scroll-target="#question-12">Question 12</a></li>
  <li><a href="#question-13" id="toc-question-13" class="nav-link" data-scroll-target="#question-13">Question 13</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 4</h1>
<p class="subtitle lead">Python <code>selenium</code>, APIs, &amp; Pandas Basics</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Byeong-Hak Choe </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 18, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 18, 2025</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="direction" class="level1">
<h1>Direction</h1>
<ul>
<li><p>Please submit your <strong>Python Script</strong> for <strong>Part 1 and Part 2 in Homework 4</strong> to Brightspace with the name below:</p>
<ul>
<li><code>danl_210_hw4_LASTNAME_FIRSTNAME.py</code><br>
( e.g., <code>danl_210_hw4_choe_byeonghak.py</code> )</li>
</ul></li>
<li><p>The due is April 18, 2025, 10:30 A.M.</p></li>
<li><p>Please send Prof.&nbsp;Choe an email (<a href="mailto::bchoe@geneseo.edu">bchoe@geneseo.edu</a>) if you have any questions.</p></li>
</ul>
<p><br></p>
</section>
<section id="part-1.-data-collection" class="level1">
<h1>Part 1. Data Collection</h1>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<ul>
<li><p>Go to the following webpage: <a href="https://www.nyc.gov/site/finance/property/property-annualized-sales-update.page">https://www.nyc.gov/site/finance/property/property-annualized-sales-update.page</a></p></li>
<li><p>Provide a Python Selenium code to download all the MS Excel files in the webpage above.</p>
<ul>
<li>Please make sure that you do not download any PDF files.</li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas as pd</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># import os</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># from selenium.webdriver.chrome.service import Service</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.chrome.options <span class="im">import</span> Options</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.common.by <span class="im">import</span> By</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Set your desired download directory</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Default download directory is usually "Download"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>download_dir <span class="op">=</span> <span class="st">'/Users/bchoe/My Drive/suny-geneseo/spring2025/lecture-code/data'</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>chrome_options <span class="op">=</span> Options()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>chrome_options.add_experimental_option(<span class="st">"prefs"</span>, {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"download.default_directory"</span>: download_dir,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"download.prompt_for_download"</span>: <span class="va">False</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"download.directory_upgrade"</span>: <span class="va">True</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"safebrowsing.enabled"</span>: <span class="va">True</span>  <span class="co"># Allow downloads without warnings</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>driver <span class="op">=</span> webdriver.Chrome(options<span class="op">=</span>chrome_options)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://www.nyc.gov/site/finance/property/property-annualized-sales-update.page'</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>driver.get(url)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Downloading only Excel files (.xlsx or .xls)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>excel_files_1 <span class="op">=</span> driver.find_elements(By.PARTIAL_LINK_TEXT, <span class="st">'Download'</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>excel_files_2 <span class="op">=</span> driver.find_elements(By.PARTIAL_LINK_TEXT, <span class="st">'M'</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>excel_files <span class="op">=</span> excel_files_1 <span class="op">+</span> excel_files_2</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> excel_files:</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">".x"</span> <span class="kw">in</span> item.get_attribute(<span class="st">'href'</span>):</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        item.click()</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        time.sleep(random.uniform(<span class="fl">.5</span>, <span class="fl">1.25</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br><br></p>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<p>The <code>series_housing_price</code> DataFrame contains FRED series <code>id</code>s for the Home Price Index across 16 metropolitan statistical areas, each categorized into three price tiers: low, middle, and high.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://bcdanl.github.io/data/fred_api_series_housing_price.csv'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>series_housing_price <span class="op">=</span> pd.read_csv(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>For more information regarding the index, please visit <a href="https://www.spglobal.com/spdji/en/documents/methodologies/methodology-sp-corelogic-cs-home-price-indices.pdf">Standard &amp; Poor’s</a>. There is more information about home price sales pairs in the Methodology section. Copyright, 2016, Standard &amp; Poor’s Financial Services LLC.</p>
<p>Provide a Python code (<strong>excluding your FRED API key</strong>) to construct the following DataFrame:</p>
<!-- ```{.python} -->
<!-- url = 'https://bcdanl.github.io/data/home_price_index_2025_01_01.csv' -->
<!-- home_price = pd.read_csv(url) -->
<!-- ``` -->
<p><br></p>
<ul>
<li><p>Note that the <code>id</code> variable in the <code>series_housing_price</code> DataFrame corresponds to the <code>series_id</code> key used in the parameter dictionary (<code>param_dicts</code>) used for making requests to the FRED API.</p></li>
<li><p>To iterate over the <code>id</code> values in the <code>series_housing_price</code> DataFrame, you can convert the variable to a list using <code>.tolist()</code>:</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> series_housing_price[<span class="st">'id'</span>].tolist():</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># do something with val</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Below replaces ‘Home Price Index (’ with ’’ (empty string) in the <code>title</code> column:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_all[<span class="st">'title'</span>] <span class="op">=</span> df_all[<span class="st">'title'</span>].<span class="bu">str</span>.replace(<span class="st">'Home Price Index ('</span>, <span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The <code>title</code> column can split into the <code>tier</code> and <code>city</code> variables using the following code:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the 'title' column into two new variables, 'ranking' and 'title'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by the first occurrence of " Tier) for ". </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># expand=True tells pandas to return the results in a DataFrame</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If expand were False, the result would be a Series of lists.</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use \) to escape the closing parenthesis, which has special meaning in regex</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df_all[[<span class="st">'tier'</span>, <span class="st">'city'</span>]] <span class="op">=</span> df_all[<span class="st">'title'</span>].<span class="bu">str</span>.split(<span class="st">' Tier\) for '</span>, expand<span class="op">=</span><span class="va">True</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The DataFrame is sorted first by <code>state</code>, then by <code>city</code> within each <code>state</code>, then by <code>date</code> in descending order within each <code>city</code>, and finally by <code>tier</code> within each <code>city</code>-<code>date</code> group.
<ul>
<li>To sort observations in a custom order (like Low, Middle, High), you can convert the <code>tier</code> variable to a categorical variable with an explicit order, and then sort.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tier'</span>: [<span class="st">'Middle'</span>, <span class="st">'High'</span>, <span class="st">'Low'</span>, <span class="st">'Middle'</span>, <span class="st">'Low'</span>],</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'city'</span>: [<span class="st">'NY'</span>, <span class="st">'LA'</span>, <span class="st">'CHI'</span>, <span class="st">'SF'</span>, <span class="st">'SEA'</span>]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>tier_order <span class="op">=</span> [<span class="st">'Low'</span>, <span class="st">'Middle'</span>, <span class="st">'High'</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'tier'</span>] <span class="op">=</span> pd.Categorical(df[<span class="st">'tier'</span>], categories<span class="op">=</span>tier_order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>df_sorted <span class="op">=</span> df.sort_values(<span class="st">'tier'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Making requests to the FRED API</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://bcdanl.github.io/data/fred_api_series_housing_price.csv'</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>series_housing_price <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>api_key <span class="op">=</span> <span class="st">'YOUR_API_KEY'</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>endpoint <span class="op">=</span> <span class="st">"series/observations"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://api.stlouisfed.org/"</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>df_all <span class="op">=</span> pd.DataFrame()</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> series_housing_price[<span class="st">'id'</span>].tolist():</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">'api_key'</span>: api_key, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">'file_type'</span>: <span class="st">'json'</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">'series_id'</span>: <span class="ss">f'</span><span class="sc">{</span>val<span class="sc">}</span><span class="ss">'</span>    </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url <span class="op">+</span> <span class="st">"fred/"</span> <span class="op">+</span> endpoint, </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                            params <span class="op">=</span> params)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert JSON response to Python dictionary.</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    fred <span class="op">=</span> response.json() </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the "observations" list element.</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame( fred[<span class="st">'observations'</span>] )</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[<span class="st">'date'</span>, <span class="st">'value'</span>]]</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'id'</span>] <span class="op">=</span> val</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    df_all <span class="op">=</span> pd.concat([df_all, df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Cleaning raw data</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_all <span class="op">=</span> df_all.merge(df_housing, on <span class="op">=</span> <span class="st">'id'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># String operations</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df_all[<span class="st">'title'</span>] <span class="op">=</span> df_all[<span class="st">'title'</span>].<span class="bu">str</span>.replace(<span class="st">'Home Price Index ('</span>, <span class="st">''</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df_all[[<span class="st">'tier'</span>, <span class="st">'city'</span>]] <span class="op">=</span> df_all[<span class="st">'title'</span>].<span class="bu">str</span>.split(<span class="st">' Tier\) for '</span>, expand<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>df_all[[<span class="st">'city'</span>, <span class="st">'state'</span>]] <span class="op">=</span> df_all[<span class="st">'city'</span>].<span class="bu">str</span>.split(<span class="st">', '</span>, expand<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting variables</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>df_all <span class="op">=</span> df_all[[<span class="st">'city'</span>, <span class="st">'state'</span>, <span class="st">'tier'</span>, <span class="st">'date'</span>, <span class="st">'value'</span>]]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Renaming</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>df_all <span class="op">=</span> df_all.rename( columns <span class="op">=</span> { <span class="st">"value"</span>: <span class="st">"home_price_index"</span> } )</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting Data Types</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>df_all <span class="op">=</span> df_all.astype({<span class="st">'value'</span>: <span class="st">'float'</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'date'</span>: <span class="st">'datetime64[ns]'</span>})</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>tier_order <span class="op">=</span> [<span class="st">'Low'</span>, <span class="st">'Middle'</span>, <span class="st">'High'</span>]  <span class="co"># your desired order</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>df_all[<span class="st">'tier'</span>] <span class="op">=</span> pd.Categorical(df_all[<span class="st">'tier'</span>], categories<span class="op">=</span>tier_order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorting</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>df_all <span class="op">=</span> df_all.sort_values([<span class="st">'state'</span>, <span class="st">'city'</span>, <span class="st">'date'</span>, <span class="st">'tier'</span>],</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                            ascending <span class="op">=</span> [<span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>])</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting DataFrame as a CSV file</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>df_all.to_csv(<span class="st">"PATHNAME_OF_df_all.csv"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>              index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br><br><br></p>
</section>
</section>
<section id="part-2.-pandas-basics" class="level1">
<h1>Part 2. Pandas Basics</h1>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The following describes the context of DataFrame in Part 2.</p>
<p><a href="https://openpaymentsdata.cms.gov">Open Payments</a>, which is managed by the Centers for Medicare &amp; Medicaid Services (CMS), is a national disclosure program created by the Affordable Care Act (ACA). The program promotes transparency and accountability by helping consumers understand the financial relationships between pharmaceutical and medical device industries, physicians, and non-physician practitioners (NPP). Non-physician practitioners (NPPs) collectively refers to physician assistants, nurse practitioners, clinical nurse specialists, certified registered nurse anesthetists/anesthesiologists and certified nurse-midwives provider types.</p>
<p>These financial relationships may include consulting fees, research grants, travel reimbursements, and payments made from the industry to medical practitioners. It is important to note that financial ties between the health care industry and health care providers do not necessarily indicate an improper relationship.</p>
<ul>
<li>Let us consider the CMS’ Open Payments data for selected cities in <strong>New York state</strong> in <strong>year 2022</strong>, the <code>cms_ny_2022</code> DataFrame:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>cms_ny_2022 <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/cms-2022-cities-all.zip'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="variable-description" class="level2">
<h2 class="anchored" data-anchor-id="variable-description">Variable Description</h2>
<table class="table">
<colgroup>
<col style="width: 37%">
<col style="width: 25%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Record_ID</code></td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identifier for a transaction between a manufacturer and a physician or an NPP</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Month</code></td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Month</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Day</code></td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Year</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Amount_of_Payment</code></td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">US dollar amount of payment to a physician or NPP</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Product</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">An indicator showing if the product is a <code>Drug</code>, <code>Device</code>, <code>Biological</code>, or <code>Medical Supply</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Product_Manufacturer</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">Manufacturer making the payment to a physician/NPP</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>NPI</code></td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">National Provider Identifier, a unique identification number for a physician/NPP receiving the payment</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Physician_or_NPP</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">An indicator showing if the recipient of the payment is a physician or non-physician practitioner (NPP)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>First_Name</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">First name of physician/NPP in New York state</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Last_Name</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">Last name of physician/NPP in New York state</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>City</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">City of the physician/NPP in New York state</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Type</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">Type of physician/NPP (e.g., <code>Medical Doctor</code>, <code>Doctor of Optometry</code>, <code>Nurse Practitioner</code>, <code>Physician Assistant</code>, and more)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Taxonomy</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">Standardized taxonomy of medical service provider (e.g., <code>Allopathic &amp; Osteopathic Physicians</code>, <code>Chiropractic Providers</code>, <code>Dental Providers</code>, <code>Physician Assistants &amp; Advanced Practice Nursing Providers</code>, and more)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Specialty</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">A specialty chosen within the standardized taxonomy (e.g., <code>Psychiatry &amp; Neurology</code>, <code>Physician Assistant</code>, <code>Chiropractor</code>, <code>Dentist</code>, <code>Family Medicine</code>, <code>Neurological Surgery</code>, and more)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Specialty_Detail</code></td>
<td style="text-align: left;">chracter</td>
<td style="text-align: left;">Detail in the specialty if any (e.g., <code>Family</code>, <code>Gastroenterology</code>, <code>Cardiovascular Disease</code>, <code>Neurology</code>, <code>Psychiatry</code>, and more)</td>
</tr>
</tbody>
</table>
<ul>
<li>Note that each physician/NPP corresponds to one single <code>Specialty_Detail</code> value.</li>
</ul>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<ul>
<li>Write a Python code to convert the <strong>string</strong> type <code>Physician_or_NPP</code> variable into the <strong>category</strong> type variable.</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cms_ny_2022[<span class="st">'Physician_or_NPP'</span>] <span class="ot">=</span> cms_ny_2022[<span class="st">'Physician_or_NPP'</span>]<span class="fu">.astype</span>(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4</h2>
<ul>
<li>Write a Python code to replace the <strong>NaN</strong> value of the <code>Specialty_Detail</code> variable with the value of the <code>Specialty</code> variable.
<ul>
<li>For example, the following shows that
<ul>
<li>All <strong>NaN</strong> values in the <code>Specialty_Detail</code> variable, where the <code>Specialty</code> is <strong>Physician Assistant</strong>, are replaced with <strong>Physician Assistant</strong>.</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>q4 <span class="op">=</span> cms_ny_2022[[<span class="st">'Specialty'</span>, <span class="st">'Specialty_Detail'</span>]]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>q4[<span class="st">'Specialty_Detail'</span>] <span class="op">=</span> np.where(q4[<span class="st">'Specialty_Detail'</span>].isna(),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                  q4[<span class="st">'Specialty'</span>],</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                  q4[<span class="st">'Specialty_Detail'</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-5" class="level2">
<h2 class="anchored" data-anchor-id="question-5">Question 5</h2>
<p>Write a Python code to count the number of transactions in which the payment amount (i.e., <code>Amount_of_Payment</code>) falls in the top 10% of all payments in the DataFrame.</p>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>top10pct <span class="op">=</span> cms_ny_2022[<span class="st">'Amount_of_Payment'</span>].quantile(<span class="fl">.9</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>cms_ny_2022[ cms_ny_2022[<span class="st">'Amount_of_Payment'</span>] <span class="op">&gt;</span> top10pct].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-6" class="level2">
<h2 class="anchored" data-anchor-id="question-6">Question 6</h2>
<p>Write a Python code to identify the city or cities with the highest number of non-missing values in the <code>Specialty_Detail</code> variable of the <code>cms_ny_2022</code> DataFrame.</p>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[ <span class="op">~</span>cms_ny_2022[<span class="st">'Specialty_Detail'</span>].isna() ][<span class="st">'City'</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a> .value_counts()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a> .reset_index()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a> .nlargest(<span class="dv">1</span>, <span class="st">'count'</span>, keep<span class="op">=</span><span class="st">"all"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-7" class="level2">
<h2 class="anchored" data-anchor-id="question-7">Question 7</h2>
<ul>
<li>Write a Python code to count the number of occurrences of each unique value in <code>Specialty_Detail</code> for each unique value in <code>Taxonomy</code>.
<ul>
<li>For example, the following displays the number of occurrences of each unique in <code>Specialty_Detail</code> for the <strong>Dental Providers</strong> <code>Taxonomy</code> value.</li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[[<span class="st">'Taxonomy'</span>, <span class="st">'Specialty_Detail'</span>]]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a> .value_counts()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a> .reset_index()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a> .sort_values([<span class="st">'Taxonomy'</span>, <span class="st">'Specialty_Detail'</span>])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-8" class="level2">
<h2 class="anchored" data-anchor-id="question-8">Question 8</h2>
<ul>
<li>Write a Python code to count the number of unique <code>Specialty_Detail</code> values for the value <strong>“Dental Providers”</strong> in <code>Taxonomy</code>.</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[cms_ny_2022[<span class="st">'Taxonomy'</span>] <span class="op">==</span> <span class="st">"Dental Providers"</span>][<span class="st">'Specialty_Detail'</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a> .nunique()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[cms_ny_2022[<span class="st">'Taxonomy'</span>] <span class="op">==</span> <span class="st">"Dental Providers"</span>][<span class="st">'Specialty_Detail'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> .value_counts()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a> .shape[<span class="dv">0</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-9" class="level2">
<h2 class="anchored" data-anchor-id="question-9">Question 9</h2>
<ul>
<li>Write a Python code (1) to count the number of missing values and (2) to calculate mean, standard deviation, minimum, first quartile, median, third quartile, and maximum of the <code>Amount_of_Payment</code> variable for the value <strong>Dermatology</strong> in the <code>Specialty</code> variable.</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[cms_ny_2022[<span class="st">'Specialty'</span>] <span class="op">==</span> <span class="st">"Dermatology"</span>][[<span class="st">'Amount_of_Payment'</span>]]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a> .info()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> cms_ny_2022[cms_ny_2022[<span class="st">'Specialty'</span>] <span class="op">==</span> <span class="st">"Dermatology"</span>][<span class="st">'Amount_of_Payment'</span>].isna()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[cms_ny_2022[<span class="st">'Specialty'</span>] <span class="op">==</span> <span class="st">"Dermatology"</span>][<span class="st">'Amount_of_Payment'</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a> .describe()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-10" class="level2">
<h2 class="anchored" data-anchor-id="question-10">Question 10</h2>
<ul>
<li>Write a Python code to replicate the following DataFrame, which calculates (1) the number of physicians in each city, (2) the number of NPPs in each city, (3) the number of physicians and NPPs in each city, and (4) the percentage of physicians and NPPs in each city, as shown below.
<ul>
<li>Ensure that the sum of the percentages of physicians and NPPs within each city is 100.</li>
<li>Ensure that the observations are sorted by <code>Total_Count</code> and <code>City</code> in descending and ascending orders, respectively.</li>
</ul></li>
</ul>
<ul>
<li>Using for-loop with dictionary container</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cms_ny_2022.shape[<span class="dv">0</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>cms_ny_2022[<span class="st">'NPI'</span>].nunique()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[[<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>, <span class="st">'NPI'</span>]]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a> .drop_duplicates()[[<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>]]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a> .value_counts()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a> .reset_index()</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> {}</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city <span class="kw">in</span> cms_ny_2022[<span class="st">'City'</span>].unique():</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> df[ df[<span class="st">'City'</span>] <span class="op">==</span> city ][<span class="st">'count'</span>].<span class="bu">sum</span>()</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    d[ city ] <span class="op">=</span> val</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>df_tot <span class="op">=</span> pd.DataFrame([d]).T.reset_index()</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>df_tot.columns <span class="op">=</span> [<span class="st">'City'</span>, <span class="st">'Total_Count'</span>]</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(df_tot, on<span class="op">=</span><span class="st">'City'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Percent'</span>] <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> df[<span class="st">'count'</span>] <span class="op">/</span> df[<span class="st">'Total_Count'</span>]</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values([<span class="st">'Total_Count'</span>, <span class="st">'City'</span>], ascending <span class="op">=</span> [<span class="va">False</span>, <span class="va">True</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Group operation with <code>groupby()</code></li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_grouped <span class="op">=</span> (</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022[[<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>, <span class="st">'NPI'</span>]]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a> .drop_duplicates()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>])</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a> .size()  <span class="co"># number of observations in each group</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a> .reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>df_grouped[<span class="st">'Total_Count'</span>] <span class="op">=</span> df_grouped.groupby(<span class="st">'City'</span>)[<span class="st">'count'</span>].transform(<span class="st">'sum'</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>df_grouped[<span class="st">'Percent'</span>] <span class="op">=</span> (<span class="dv">100</span> <span class="op">*</span> df_grouped[<span class="st">'count'</span>] <span class="op">/</span> df_grouped[<span class="st">'Total_Count'</span>])</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>df_grouped <span class="op">=</span> df_grouped.sort_values([<span class="st">'Total_Count'</span>, <span class="st">'City'</span>], ascending <span class="op">=</span> [<span class="va">False</span>, <span class="va">True</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Group operation with <code>assign()</code> and <code>lambda</code></li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_grouped <span class="op">=</span> (</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    cms_ny_2022[[<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>, <span class="st">'NPI'</span>]]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    .drop_duplicates()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>])</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    .reset_index(name <span class="op">=</span> <span class="st">'count'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    .assign(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        Total_Count <span class="op">=</span> <span class="kw">lambda</span> df: df.groupby(<span class="st">'City'</span>)[<span class="st">'count'</span>].transform(<span class="st">'sum'</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        Percent <span class="op">=</span> <span class="kw">lambda</span> df: <span class="dv">100</span> <span class="op">*</span> df[<span class="st">'count'</span>] <span class="op">/</span> df[<span class="st">'Total_Count'</span>]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    .sort_values([<span class="st">'Total_Count'</span>, <span class="st">'City'</span>], ascending<span class="op">=</span>[<span class="va">False</span>, <span class="va">True</span>])</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-11" class="level2">
<h2 class="anchored" data-anchor-id="question-11">Question 11</h2>
<ul>
<li>Write a Python code to calculate:
<ul>
<li>The total <code>Amount_of_Payment</code> the <code>Product_Manufacturer</code> <strong>AbbVie Inc.</strong> paid to physicians and non-physician practitioners (NPPs) in <code>Cities</code> of <strong>Rochester</strong>, <strong>Buffalo</strong>, and <strong>Syracuse</strong>.</li>
<li>How many times the <code>Product_Manufacturer</code> <strong>AbbVie Inc.</strong> paid to physicians and non-physician practitioners (NPPs) in in <code>Cities</code> of <strong>Rochester</strong>, <strong>Buffalo</strong>, and <strong>Syracuse</strong>.</li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022.query(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">'Product_Manufacturer == "AbbVie Inc." &amp; City.isin(["Rochester", "Buffalo", "Syracuse"])'</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>     )[<span class="st">'Amount_of_Payment'</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a> cms_ny_2022.query(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">'Product_Manufacturer == "AbbVie Inc." &amp; City.isin(["Rochester", "Buffalo", "Syracuse"])'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a> .shape[<span class="dv">0</span>]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-12" class="level2">
<h2 class="anchored" data-anchor-id="question-12">Question 12</h2>
<ul>
<li>Consider the following two DataFrames, <code>cms_ny_2022_npi</code> and <code>cms_ny_2022_records</code>:</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_npi <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/cms-2022-cities-npi.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>cms_ny_2022_npi</code>: This DataFrame is created from <code>cms_ny_2022</code> by selecting only the columns <code>NPI</code>, <code>Physician_or_NPP</code>, <code>First_Name</code>, <code>Last_Name</code>, <code>City</code>, <code>Type</code>, <code>Taxonomy</code>, <code>Specialty</code>, and <code>Specialty_Detail.</code></li>
<li>In addition, it contains only unique observations (i.e., there are no duplicate rows).</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_records <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/cms-2022-cities-records.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><code>cms_ny_2022_records</code>: This DataFrame is derived from <code>cms_ny_2022</code> by including every observation but only retaining the columns <code>Record_ID</code>, <code>Month</code>, <code>Day</code>, <code>Amount_of_Payment</code>, <code>Product</code>, <code>Product_Manufacturer</code>, and <code>NPI</code>.</p></li>
<li><p>Write a Python code to create the <code>cms_ny_2022</code> DataFrame by using the <code>cms_ny_2022_npi</code> and <code>cms_ny_2022_records</code> DataFrames.</p></li>
<li><p>Below is the many-to-many join. Therefore, the <code>cms_ny_2022_new</code> DataFrame has more observations than <code>cms_ny_2022</code>.</p></li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_new <span class="op">=</span> cms_ny_2022_records.merge(cms_ny_2022_npi, on <span class="op">=</span> <span class="st">'NPI'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>This happens because <code>NPI</code> variable in the <code>cms_ny_2022_npi</code> DataFrame has duplicate values.</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividing `cms_ny_2022_npi` into the two DataFrames</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_npi_dup <span class="op">=</span> cms_ny_2022_npi[cms_ny_2022_npi[<span class="st">'NPI'</span>].duplicated(keep<span class="op">=</span><span class="va">False</span>)].sort_values(<span class="st">'NPI'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_npi_unique <span class="op">=</span> cms_ny_2022_npi[<span class="op">~</span>cms_ny_2022_npi[<span class="st">'NPI'</span>].duplicated(keep<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a DataFrame with only non-duplicate values in NPI variable:</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_npi_dup_to_unique <span class="op">=</span> cms_ny_2022_npi_dup.drop_duplicates(subset<span class="op">=</span>[<span class="st">'NPI'</span>], keep<span class="op">=</span><span class="st">'first'</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_npi_unique_all <span class="op">=</span> pd.concat([cms_ny_2022_npi_unique, cms_ny_2022_npi_dup_to_unique])</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Below can match the number of observations in cms_ny_2022, </span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># but may not match values in non-NPI variables in cms_ny_2022_npi</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>cms_ny_2022_new2 <span class="op">=</span> cms_ny_2022_records.merge(cms_ny_2022_npi_unique_all, on <span class="op">=</span> <span class="st">'NPI'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># To replicate cms_ny_2022, we need to create a new key variable that uniquely identifies observations in `cms_ny_2022_npi`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="question-13" class="level2">
<h2 class="anchored" data-anchor-id="question-13">Question 13</h2>
<ul>
<li>Write a Python code to create the following DataFrame, <code>City_Physician_or_NPP</code>, which counts the number of physicians and the non-physician practitioners (NPPs) in each city.</li>
</ul>
<ul>
<li>Below is correct:</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>City_Physician_or_NPP <span class="op">=</span> (</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    cms_ny_2022[[<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>, <span class="st">'NPI'</span>]]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    .drop_duplicates()[[<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>]]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    .value_counts()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    .pivot(index <span class="op">=</span> <span class="st">'City'</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>           columns <span class="op">=</span> <span class="st">'Physician_or_NPP'</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>           values <span class="op">=</span> <span class="st">'count'</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Below is incorrect:</li>
</ul>
<div class="cell">
<details>
<summary>Click to Check the Answer!</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>City_Physician_or_NPP <span class="op">=</span> (</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    cms_ny_2022[[<span class="st">'City'</span>, <span class="st">'Physician_or_NPP'</span>]]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    .value_counts()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    .pivot(index <span class="op">=</span> <span class="st">'City'</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>           columns <span class="op">=</span> <span class="st">'Physician_or_NPP'</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>           values <span class="op">=</span> <span class="st">'count'</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">powered with github, quarto, and rstudio<br>byeong-hak choe, 2025</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<div id="scroll-padding"></div>
<script src="../assets/js/site.js"></script>
<script src="../assets/js/posts.js"></script>



</body></html>